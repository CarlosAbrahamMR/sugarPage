(function($){
    $.fn.setBreakpoints = function(settings){
        var options = $.extend({
            distinct: true,
            breakpoints: [320,480,768,1024]
        }, settings);

        var lastSize = 0;

        if (options.breakpoints.length < 1) {
            return this;
        }

        // sort list ascending
        options.breakpoints.sort(function(a,b){ return a-b; });

        var getNextBreakpoint = function(width) {
            for (var i = 0; i < options.breakpoints.length; i++) {
                if (width <= options.breakpoints[i]) {
                    return options.breakpoints[i];
                }
            }
            return null;
        };

        var getPrevBreakpoint = function(width) {
            for (var i = options.breakpoints.length-1; i >= 0; i--) {
                if (width >= options.breakpoints[i]) {
                    return options.breakpoints[i];
                }
            }
            return null;
        };

        var onResize = function() {
            var width = $(window).width();
            var newSize = getNextBreakpoint(width) || getPrevBreakpoint(width);

            if (options.distinct) {
                if (newSize != lastSize) {
                    // trigger a new breakpoint event
                    $(window).trigger('enterBreakpoint'+newSize);
                    lastSize = newSize;
                }
            } else {
                $(window).trigger('enterBreakpoint'+newSize);
            }
        };

        $(window).bind('resize', onResize);
        onResize();

        return this;
    };
})(jQuery);
